<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Documentos</title>
  <link rel="stylesheet" href="./styles.css">
  
</head>

<body>
  <header>
    <div class="wrap">
      <h1 id="pageTitle">Documentos</h1>
      <p id="pageIntro">Listado de documentos asociados a modelos y productos.</p>

      <div class="controls">
        <div class="search">
          <label for="q">Buscar</label>
          <input id="q" type="search" placeholder="Modelo o producto..." autocomplete="off" />
        </div>
        <div class="badge"><span id="count">0</span> resultados</div>
      </div>
    </div>
  </header>

  <main>
    <div class="wrap">
      <div class="card">
        <table aria-label="Tabla de documentos">
          <thead>
            <tr>
              <th style="width: 35%;">Modelo</th>
              <th style="width: 45%;">Producto</th>
              <th style="width: 20%;">Documento</th>
            </tr>
          </thead>
          <tbody id="rows"></tbody>
        </table>
        <div id="empty" class="empty">No hay resultados.</div>
      </div>
    </div>
  </main>

  <script>
    const DATA_URL = "./data.json";
    let allRows = [];

    const norm = (s) => (s ?? "").toString().toLowerCase().trim();

    function render(rows) {
      const tbody = document.getElementById("rows");
      const empty = document.getElementById("empty");
      const count = document.getElementById("count");

      tbody.innerHTML = "";
      count.textContent = rows.length;

      if (rows.length === 0) {
        empty.style.display = "block";
        return;
      }
      empty.style.display = "none";

      for (const r of rows) {
        const tr = document.createElement("tr");

        const tdModelo = document.createElement("td");
        tdModelo.textContent = r.modelo;

        const tdProducto = document.createElement("td");
        tdProducto.textContent = r.producto;

        const tdDocumento = document.createElement("td");
        const a = document.createElement("a");
        a.className = "btn";
        a.textContent = r.documento?.texto || "Ver documento";
        a.href = r.documento?.url || "#";
        a.target = "_blank";
        a.rel = "noopener";
        tdDocumento.appendChild(a);

        tr.appendChild(tdModelo);
        tr.appendChild(tdProducto);
        tr.appendChild(tdDocumento);

        tbody.appendChild(tr);
      }
    }

    function applyFilter() {
      const q = norm(document.getElementById("q").value);
      if (!q) return render(allRows);

      const filtered = allRows.filter(r =>
        norm(r.modelo).includes(q) || norm(r.producto).includes(q)
      );

      render(filtered);
    }

    async function load() {
      const res = await fetch(DATA_URL, { cache: "no-store" });
      if (!res.ok) throw new Error("No se pudo cargar el JSON: " + res.status);

      const data = await res.json();

      document.title = data.title || "Documentos";
      document.getElementById("pageTitle").textContent = data.title || "Documentos";
      document.getElementById("pageIntro").textContent = data.intro || "Listado de documentos asociados a modelos y productos.";

      allRows = Array.isArray(data.rows) ? data.rows : [];
      render(allRows);

      document.getElementById("q").addEventListener("input", applyFilter);
    }

    load().catch(err => {
      console.error(err);
      document.getElementById("pageTitle").textContent = "Error cargando datos";
      document.getElementById("pageIntro").textContent =
        "Revisa la ruta del JSON y que est√©s sirviendo esto desde un servidor (no file://).";
    });
  </script>
</body>
</html>
